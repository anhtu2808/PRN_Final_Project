@page "{id:int}"
@using LaptopRentalManagement.BLL.DTOs.Response
@model LaptopRentalManagement.Pages.Laptops.DetailsModel
@{
    ViewData["Title"] = "Laptop Details";
    Layout = "~/Pages/Shared/_CustomerLayout.cshtml";
}

<div class="container py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item"><a href="/laptops">Laptops</a></li>
            <li class="breadcrumb-item active" aria-current="page">@Model.Laptop?.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Laptop Images -->
        <div class="col-lg-6 mb-4">
            <div class="laptop-detail-images">
                <!-- Main Image -->
                <div class="main-image mb-3">
                    <img
                        src="https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=600&h=400&fit=crop"
                        alt="@Model.Laptop?.Name" class="img-fluid rounded shadow">
                    <div class="image-badges">
                        @if (Model.Laptop?.Status == "Available")
                        {
                            <span class="badge bg-success">Available</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Rented</span>
                        }
                    </div>
                </div>

            </div>
        </div>

        <!-- Laptop Info & Booking -->
        <div class="col-lg-6">
            <div class="laptop-detail-info">
                <!-- Brand & Title -->
                <div class="laptop-header mb-3">
                    <div class="laptop-brand h6 text-primary">@Model.Laptop?.Brand?.Name</div>
                    <h1 class="laptop-title h2 mb-2">@Model.Laptop?.Name</h1>
                    <div class="laptop-subtitle text-muted">High-performance laptop suitable for work, study, and
                        entertainment.
                    </div>
                </div>
                <!--User Profile -->
                <div class="laptop-owner mb-3">
                    <div class="fw-bold">Rented by:</div>
                    <div class="d-flex align-items-center mt-1">
                        <div>
                            <div>@Model.Laptop?.Owner.Name</div>
                            <small class="text-muted">@Model.Laptop?.Owner?.Email</small>
                        </div>
                    </div>
                </div>

                <!-- Rating & Reviews -->
                <div class="laptop-rating mb-3">
                    <div class="stars">
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star-half-alt text-warning"></i>
                    </div>
                    <span class="rating-text ms-2">4.5 (127 reviews)</span>
                </div>

                <!-- Pricing -->
                <div class="price-daily h3 text-primary mb-2">
                    @Model.Laptop?.PricePerDay.ToString("N0") ₫ <span class="price-label h6 text-muted">per day</span>
                </div>

                <!-- Booking Form -->
                <form method="post" class="booking-form bg-light p-4 rounded mb-4">
                    @Html.AntiForgeryToken()
                    <h5 class="mb-3">Chọn ngày thuê</h5>

                    <div class="row g-2 mb-3">
                        @foreach (var slot in Model.Slots.OrderBy(s => s.SlotDate))
                        {
                            var isAvailable = slot.Status == "Available";
                            var dateLabel = slot.SlotDate.ToString("dd/MM/yyyy");
                            var id = $"slot_{slot.SlotId}";

                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="@id" name="SelectedSlots" value="@slot.SlotId" @(isAvailable ? "" : "disabled") />
                                    <label class="form-check-label @(isAvailable ? "" : "text-muted")" for="@id">
                                        @dateLabel
                                    </label>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="rental-summary mb-3 p-3 bg-white rounded">
                        <div class="d-flex justify-content-between">
                            <span>Ngày đã chọn:</span>
                            <span id="selectedCount">0 ngày</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Giá mỗi ngày:</span>
                            <span>@Model.Laptop?.PricePerDay.ToString("N0")₫</span>
                        </div>
                        <hr />
                        <div class="d-flex justify-content-between fw-bold">
                            <span>Tổng tiền:</span>
                            <span id="totalPrice">₫0</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 mb-2">
                        <i class="fas fa-shopping-cart me-2"></i>Đặt thuê
                    </button>
                </form>

                <!-- Quick Info -->
                <div class="quick-info">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="info-item">
                                <i class="fas fa-truck text-primary"></i>
                                <div class="info-text">Free Delivery</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="info-item">
                                <i class="fas fa-shield-alt text-success"></i>
                                <div class="info-text">Insured</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="info-item">
                                <i class="fas fa-headset text-info"></i>
                                <div class="info-text">24/7 Support</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Info Tabs -->
    <div class="row mt-5">
        <div class="col-12">
            <ul class="nav nav-tabs" id="laptopDetailTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs"
                            type="button">
                        <i class="fas fa-microchip me-2"></i>Specifications
                    </button>
                </li>
                @* <li class="nav-item" role="presentation"> *@
                @*     <button class="nav-link" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" *@
                @*             type="button"> *@
                @*         <i class="fas fa-info-circle me-2"></i>Description *@
                @*     </button> *@
                @* </li> *@
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews"
                            type="button">
                        <i class="fas fa-star me-2"></i>Reviews (127)
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="policies-tab" data-bs-toggle="tab" data-bs-target="#policies"
                            type="button">
                        <i class="fas fa-file-contract me-2"></i>Rental Policies
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="laptopDetailTabsContent">
                <!-- Specifications -->
                <div class="tab-pane fade show active" id="specs" role="tabpanel">
                    <div class="specs-content p-4">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="fw-bold">Processor</h6>
                                <p>@Model.Laptop?.Cpu</p>

                                <h6 class="fw-bold">Memory</h6>
                                <p>@Model.Laptop?.Ram GB RAM</p>

                                <h6 class="fw-bold">Storage</h6>
                                <p>@Model.Laptop?.Storage GB SSD</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="fw-bold">Status</h6>
                                <p>@Model.Laptop?.Status</p>

                                <h6 class="fw-bold">Brand</h6>
                                <p>@Model.Laptop?.Brand?.Name</p>

                                <h6 class="fw-bold">Categories</h6>
                                <p>
                                    @foreach (var category in Model.Laptop?.Categories ?? new List<CategoryResponse>())
                                    {
                                        @category.Name<br/>
                                    }
                                </p>

                                <h6 class="fw-bold">Listed On</h6>
                                <p>@Model.Laptop?.CreatedAt.ToString("dd/MM/yyyy")</p>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Description -->
                <div class="tab-pane fade" id="description" role="tabpanel">
                    <div class="description-content p-4">
                        <h5>About This Laptop</h5>
                        <p>The MacBook Pro M2 14" is designed for professionals who demand the ultimate in performance
                            and portability. With the revolutionary M2 Pro chip, this laptop delivers incredible speed
                            and efficiency for demanding workflows.</p>

                        <h6>Perfect For:</h6>
                        <ul>
                            <li>Software development and programming</li>
                            <li>Video editing and content creation</li>
                            <li>Graphic design and digital art</li>
                            <li>Business presentations and productivity</li>
                            <li>Scientific computing and data analysis</li>
                        </ul>

                        <h6>Included Accessories:</h6>
                        <ul>
                            <li>MagSafe 3 charging cable</li>
                            <li>67W USB-C Power Adapter</li>
                            <li>Laptop carrying case</li>
                            <li>Cleaning cloth</li>
                        </ul>
                    </div>
                </div>

                <!-- Reviews -->
                <div class="tab-pane fade" id="reviews" role="tabpanel">
                    <div class="reviews-content p-4">
                        <div class="review-summary mb-4">
                            <div class="row">
                                <div class="col-md-3 text-center">
                                    <div class="overall-rating">
                                        <div class="rating-number h2">4.5</div>
                                        <div class="stars mb-2">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star-half-alt text-warning"></i>
                                        </div>
                                        <div class="text-muted">127 reviews</div>
                                    </div>
                                </div>
                                <div class="col-md-9">
                                    <div class="rating-breakdown">
                                        <div class="rating-bar d-flex align-items-center mb-2">
                                            <span class="rating-label">5 stars</span>
                                            <div class="progress flex-grow-1 mx-3">
                                                <div class="progress-bar bg-warning" style="width: 70%"></div>
                                            </div>
                                            <span class="rating-count">89</span>
                                        </div>
                                        <div class="rating-bar d-flex align-items-center mb-2">
                                            <span class="rating-label">4 stars</span>
                                            <div class="progress flex-grow-1 mx-3">
                                                <div class="progress-bar bg-warning" style="width: 20%"></div>
                                            </div>
                                            <span class="rating-count">25</span>
                                        </div>
                                        <div class="rating-bar d-flex align-items-center mb-2">
                                            <span class="rating-label">3 stars</span>
                                            <div class="progress flex-grow-1 mx-3">
                                                <div class="progress-bar bg-warning" style="width: 8%"></div>
                                            </div>
                                            <span class="rating-count">10</span>
                                        </div>
                                        <div class="rating-bar d-flex align-items-center mb-2">
                                            <span class="rating-label">2 stars</span>
                                            <div class="progress flex-grow-1 mx-3">
                                                <div class="progress-bar bg-warning" style="width: 2%"></div>
                                            </div>
                                            <span class="rating-count">2</span>
                                        </div>
                                        <div class="rating-bar d-flex align-items-center">
                                            <span class="rating-label">1 star</span>
                                            <div class="progress flex-grow-1 mx-3">
                                                <div class="progress-bar bg-warning" style="width: 1%"></div>
                                            </div>
                                            <span class="rating-count">1</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Individual Reviews -->
                        <div class="individual-reviews">
                            <div class="review-item border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <div class="reviewer-name fw-bold">John Doe</div>
                                        <div class="review-stars">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="review-date text-muted">2 days ago</div>
                                </div>
                                <div class="review-text">
                                    Perfect for my video editing work. The M2 chip handles 4K footage without any lag.
                                    Great battery life and the display is stunning. Highly recommended!
                                </div>
                            </div>

                            <div class="review-item border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <div class="reviewer-name fw-bold">Sarah Chen</div>
                                        <div class="review-stars">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="far fa-star text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="review-date text-muted">1 week ago</div>
                                </div>
                                <div class="review-text">
                                    Excellent laptop for development work. Very fast compilation times and smooth
                                    multitasking.
                                    The rental process was smooth and delivery was on time.
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-outline-primary">Load More Reviews</button>
                    </div>
                </div>

                <!-- Policies -->
                <div class="tab-pane fade" id="policies" role="tabpanel">
                    <div class="policies-content p-4">
                        <h5>Rental Terms & Conditions</h5>

                        <h6>Rental Period</h6>
                        <ul>
                            <li>Minimum rental period: 1 day</li>
                            <li>Maximum rental period: 6 months</li>
                            <li>Extensions possible with advance notice</li>
                        </ul>

                        <h6>Damage Policy</h6>
                        <ul>
                            <li>Security deposit: ₫5,000,000 (refundable)</li>
                            <li>Minor cosmetic damage: No charge</li>
                            <li>Repair costs charged for functional damage</li>
                            <li>Replacement cost for lost/stolen devices</li>
                        </ul>

                        <h6>Delivery & Pickup</h6>
                        <ul>
                            <li>Free delivery within 20km of city center</li>
                            <li>Same-day delivery available for orders before 2 PM</li>
                            <li>Free pickup at end of rental period</li>
                            <li>Express delivery available for additional fee</li>
                        </ul>

                        <h6>Cancellation Policy</h6>
                        <ul>
                            <li>Free cancellation up to 24 hours before start date</li>
                            <li>50% refund for cancellations within 24 hours</li>
                            <li>No refund for cancellations after delivery</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Laptops -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4">You Might Also Like</h3>
            <div class="row">
                @foreach (var laptop in Model.SimilarLaptops)
                {
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="laptop-card">
                            <div class="laptop-image">
                                <img
                                    src="@(string.IsNullOrEmpty(laptop.ImageURL) ? "https://techterms.com/img/xl/laptop_586.png" : laptop.ImageURL)"
                                    alt="@laptop.Name" class="img-fluid">
                            </div>
                            <div class="laptop-info">
                                <div class="laptop-brand">@laptop.Brand.Name</div>
                                <h6 class="laptop-title">@laptop.Name</h6>
                                <div class="price-daily">@($"{laptop.PricePerDay:N0}₫") <span class="price-label">per day</span>
                                </div>
                                <a href="/laptops/details/@laptop.LaptopId" class="btn btn-outline-primary btn-sm mt-2">View
                                    Details</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const slotCheckboxes = document.querySelectorAll('input[name="SelectedSlots"]');
            const selectedCount = document.getElementById('selectedCount');
            const totalPrice = document.getElementById('totalPrice');
            const dailyRate = @Model.Laptop?.PricePerDay ?? 0;

            function updateSummary() {
                const selected = Array.from(slotCheckboxes).filter(cb => cb.checked).length;
                const total = selected * dailyRate;
                selectedCount.textContent = `${selected} ngày`;
                totalPrice.textContent = `₫${total.toLocaleString()}`;
            }

            slotCheckboxes.forEach(cb => cb.addEventListener('change', updateSummary));
        });
    </script>
}